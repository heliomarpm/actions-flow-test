name: üß™ Contract Tests ‚Äì Reusable Actions
description: Automated CI contract validation for reusable workflows

on:
  workflow_dispatch:
  push:
    branches: [ develop, feature**, feat**, hotfix**, fix** ]

jobs:
  quality:
    name: strategy ‚Äì ${{ matrix.fixture }} | ${{ matrix.scenario }}
    strategy:
      fail-fast: false
      matrix:
        fixture:
          - node-vitest
          # - node-custom-ok
          # - node-custom-no-summary
          # - node-runner-missing
          # - node-jest
          # - php-phpunit
          # - python-pytest
          # - dotnet-xunit
          # - go
          # - node-no-tests # deve falhar
          # - php-no-tests  # deve falhar
          # - python-no-tests # deve falhar
          # - dotnet-no-tests # deve falhar
          # - go-no-tests # deve falhar

        scenario:
          - default
          - coverage-block
          # - coverage-decrease

    uses: heliomarpm/actions-flow/.github/workflows/ci-quality.yml@main
    with:
      project_path: fixtures/${{ matrix.fixture }}
      coverage_mode: ${{ matrix.scenario == 'coverage-block' && 'block' || matrix.scenario == 'coverage-decrease' && 'decrease' || 'info' }}
# jobs:
  # test:
  #   runs-on: ubuntu-latest
  #   strategy:
  #     fail-fast: false
  #     matrix:
  #       fixture:
  #       - node-vitest


  #       scenario:
  #       - info
  #       - no-tests
  #       - coverage-block
  #       - coverage-decrease

  #   defaults:
  #     run:
  #       working-directory: fixtures/${{ matrix.fixture }}/actions/quality

  #   steps:
  #   - uses: actions/checkout@v4

  #   - name: Setup Node
  #     uses: actions/setup-node@v4
  #     with:
  #       node-version: 20

  #   - name: Load environment
  #     run: |

  #       if [ -f "${{ matrix.scenario }}/.env" ]; then
  #         cat .env >> $GITHUB_ENV
  #       fi

  #   - name: Run Quality Workflow
  #     uses: heliomarpm/actions-flow/.github/workflows/ci-quality-gate.yml@main
  #     with:
  #       project_path: fixtures/${{ matrix.fixture }}
  #       coverage_mode: ${{ matrix.scenario == 'coverage-block' && 'block' || matrix.scenario == 'coverage-decrease' && 'decrease' || 'info' }}
  #       coverage_strategy: ${{ vars.COVERAGE_STRATEGY }}
  #       coverage_command: ${{ vars.COVERAGE_COMMAND }}

  #   - name: Validate contract
  #     run: |
  #       EXPECTED=$(jq -r ".\"${{ matrix.scenario }}\"" contract.json)

  #       if [ "$EXPECTED" = "success" ] && [ "${{ steps.quality.outcome }}" != "success" ]; then
  #         echo "‚ùå Expected success but failed"
  #         exit 1
  #       fi

  #       if [ "$EXPECTED" = "failure" ] && [ "${{ steps.quality.outcome }}" = "success" ]; then
  #         echo "‚ùå Expected failure but passed"
  #         exit 1
  #       fi

  #       echo "‚úÖ Contract respected"
